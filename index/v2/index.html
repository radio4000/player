<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<script
			type="module"
			src="https://cdn.jsdelivr.net/npm/@radio4000/components"
		></script>
		<style>
			html,
			body,
			r4-player {
				min-height: 100%;
				min-width: 100%;
				display: flex;
				margin: 0;
			}
			r4-player radio4000-player {
				flex-grow: 1;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<script type="module">
			import { sdk } from "https://cdn.jsdelivr.net/npm/@radio4000/sdk/+esm";

			//import { createImage } from "https://cdn.jsdelivr.net/npm/@radio4000/components/r4-avatar/+esm";
			/**
			 * @param {string} id - from cloudinary image
			 */
			export function createImage(id) {
				const baseUrl = "https://res.cloudinary.com/radio4000/image/upload";
				const size = 250;
				const dimensions = `w_${size},h_${size}`;
				const crop = "c_thumb,q_60";
				return `${baseUrl}/${dimensions},${crop},fl_awebp/${id}.webp`;
			}

			(async ({ slug = "" }) => {
				if (!slug) return;
				const { data: channel } = await sdk.channels.readChannel(slug);
				const { data: tracks } = await sdk.channels.readChannelTracks(slug);
				const $app = document.createElement("r4-player");
				$app.setAttribute("href", window.location.origin);
				$app.setAttribute("name", channel.name);
				$app.setAttribute("image", createImage(channel.image));
				$app.tracks = tracks
					.map((track) => ({
						...track,
						body: track.description,
					}))
					.reverse();

				/* $app.setAttribute("channel", slug);
				 $app.setAttribute("single-channel", true); */
				document.querySelector("body").append($app);
			})(Object.fromEntries(new URLSearchParams(window.location.search)));
		</script>
	</body>
</html>
